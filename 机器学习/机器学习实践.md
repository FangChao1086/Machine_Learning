# 机器学习实践

* [数据处理](#数据处理)
  * [性别_转换成数值](#性别_转换成数值)
  * [缺失值填充](#缺失值填充)
    * [年龄_随机森林预测](#年龄_随机森林预测)
* [regression](#regression)
  * [回归](#回归)  
    * [LinearRegression](#LinearRegression)
    * [Lasso/Ridge--GridSearchCV](#Lasso)
  * [分类](#分类)  
    * [LogisticRegression--Pipeline](#LogisticRegression)
* [RandomForest](#RandomForest)
  * [分类](#分类_R)  
    * [RandomForestClassifier](#RandomForestClassifier)
* [XGBoost](#XGBoost)
* [GBDT(梯度提升树简易教程)](#GBDT(梯度提升树简易教程))
* [pandas](#pandas)
  * [pandas编码objects type](#pandas编码objects_type)

<span id="数据处理"></span>
## 数据处理
<span id="性别"></span>
## 性别_转换成数值
```python
data['Sex'] = data['Sex'].map({'female': 0, 'male': 1}).astype(int)
```
<span id="缺失值填充"></span>
## 缺失值填充
<span id="年龄_随机森林预测"></span>
### 年龄_随机森林预测
```python
from sklearn.ensemble import RandomForestRegressor

data_for_age = data[['Age', 'Survived', 'Fare', 'Parch', 'SibSp', 'Pclass']]
age_exist = data_for_age.loc[(data.Age.notnull())]   # 年龄不缺失的数据
age_null = data_for_age.loc[(data.Age.isnull())]
x = age_exist.values[:, 1:]
y = age_exist.values[:, 0]

rfr = RandomForestRegressor(n_estimators=1000)
rfr.fit(x, y)
age_hat = rfr.predict(age_null.values[:, 1:])
data.loc[(data.Age.isnull()), 'Age'] = age_hat
```

<span id="regression"></span>
## regression  
<span id="回归"></span>
[链接：详细代码](https://github.com/FangChao1086/Machine_learning/tree/master/Regression)
## 回归
<span id="LinearRegression"></span>
### LinearRegression
```python
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_squared_error

# 训练
x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.3, random_state=1)
lin_reg = LinearRegression()
lin_reg.fit(x_train, y_train)
# 参数
print(lin_reg.coef_)
print(lin_reg.intercept_)

# 预测评估
y_hat = lin_reg.predict(x_test)
mse_loss = mean_squared_error(y_test, y_hat)
print('mse:', mse_loss)
```
<span id="Lasso"></span>
### Lasso/Ridge--GridSearchCV
```python
from sklearn.model_selection import train_test_split, GridSearchCV
from sklearn.linear_model import Lasso, Ridge
from sklearn.metrics import r2_score

# 训练
x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.3, random_state=1)
model = Lasso()     # L1
# model = Ridge()   # L2
alpha_scan = np.logspace(-6, 2, 10)
lasso_model = GridSearchCV(model, param_grid={'alpha': alpha_scan}, cv=5)
lasso_model.fit(x_train, y_train)
# 参数
print(lasso_model.best_params_)

# 预测评估
y_hat = lasso_model.predict(x_test)
r2 = r2_score(y_test, y_hat)
print("r2_score:", r2)
```
<span id="分类"></span>
## 分类
<span id="LogisticRegression"></span>
### LogisticRegression--Pipeline
```python
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LogisticRegression
from sklearn.preprocessing import StandardScaler
from sklearn.pipeline import Pipeline
from sklearn.metrics import roc_curve

# 训练
x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.3, random_state=1, stratify=y)
model = Pipeline([('sc', StandardScaler()),
                  ('clf', LogisticRegression())])
model.fit(x_train, y_train)
# 参数
print(model.get_params())

# 预测评估
y_hat = model.predict(x_test)
fpr, tpr, threshold = roc_curve(y_test, y_hat)
  ## 画图
## 中文显示
# import matplotlib as mpl
# mpl.rcParams['font.sans-serif'] = [u'simHei']
# mpl.rcParams['axes.unicode_minus'] = False
```

<span id="RandomForest"></span>
## RandomForest  
[链接：详细代码](https://github.com/FangChao1086/Machine_learning/tree/master/RandomForest)  
<span id="分类_R"><span>
## 分类
<span id="RandomForestClassifier"></span>  
### RandomForestClassifier  
```python
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score

# 训练
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=1, stratify=y)
clf = RandomForestClassifier(n_estimators=500, max_depth=6,
                             min_samples_leaf=3, criterion="gini",
                             random_state=1, n_jobs=-1)
clf.fit(X_train, y_train)

# 预测评估
prediction = clf.predict(X_test)
acc = accuracy_score(y_test, prediction)
print('The accuracy of Random Forest is {}'.format(acc))
```

<span id="XGBoost"></span>
## XGBoost
[链接：详细代码](https://github.com/FangChao1086/Machine_learning/tree/master/XGBOOST)
```python
import xgboost as xgb

# 训练测试集读取
x_train, x_test, y_train, y_test = train_test_split(x, y, random_state=1, test_size=0.5)
data_train = xgb.DMatrix(x_train, label=y_train)
data_test = xgb.DMatrix(x_test, label=y_test)

# 训练
watch_list = [(data_test, 'eval'), (data_train, 'train')]
param = {'max_depth': 3, 'eta': 1, 'silent': 0, 'objective': 'multi:softmax', 'num_class': 3}
bst = xgb.train(param, data_train, num_boost_round=4, evals=watch_list)

# 预测
y_hat = bst.predict(data_test)
```

<span id="GBDT(梯度提升树简易教程)"></span>
## GBDT(梯度提升树简易教程)
[参考链接：GBDT(梯度提升树简易教程)](https://github.com/Freemanzxp/GBDT_Simple_Tutorial)  

 回归  
 二分类  
 多分类  
 可视化  
 
### 结果：
![GBDT-regression](https://i.ibb.co/3SLfzR7/GBDT-regression.png)  

<span id="pandas"></span>
## pandas
<span id="pandas编码objects_type"></span>
### pandas编码objects type
```python
# 编码所有的object type
from sklearn import preprocessing

for x in train.columns:
    if train[x].dtype == 'object':
        lbl = preprocessing.LabelEncoder()
        lbl.fit(list(train[x].values))
        train[x] = lbl.transform(list(train[x].values))

```
